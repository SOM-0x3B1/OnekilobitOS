<!DOCTYPE html>
<html>

<head>
	<title>Onekilobit OS</title>
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="style.css">
	<link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
	<link rel="icon" href="favicon.png">
</head>

<body>
	<h1 class="startScreen">
		<pre>
  ___             _    _ _       _     _ _      ___  ____  
 / _ \ _ __   ___| | _(_) | ___ | |__ (_) |_   / _ \/ ___| 
| | | | '_ \ / _ \ |/ / | |/ _ \| '_ \| | __| | | | \___ \ 
| |_| | | | |  __/   <| | | (_) | |_) | | |_  | |_| |___) |
 \___/|_| |_|\___|_|\_\_|_|\___/|_.__/|_|\__|  \___/|____/  </pre>
		<button onclick="start(); setTimeout(afterstart,9100)">START</button>
	</h1>

	<h2>Onbekilobit OS v0.0.2</h2>
	<a id="back" href="\">Back to safety</a>

	<div class="terminal">
		<ul id="ul">
			<li></li>
		</ul>

		<p id="command_line"><span>> <input type="text" id="command" value=""></span></p>
	</div>

	<div id="messengerWindow">
		<form>
			<input type="text" id="m" />
			<input type="submit" id="submitButton" value="submit" />
		</form>
		<ul id="messages"></ul>
	</div>
</body>


<script type="text/javascript" src="sound.js"></script>
<script type="text/javascript" src="script.js"></script>


<script src="/socket.io/socket.io.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
	crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.26.0/moment.min.js"></script>

<script>
	let userName = prompt("whats your name");
	let room = prompt("room name");
	let ID = "";
	var socket = io();
	//send event that user has joined room
	socket.emit("join room", { username: userName, roomName: room });

	//receive data from server.
	socket.on('send data', (data) => {
		ID = data.id; //ID will be used later
		console.log(" my ID:" + ID);
	})
	$("#m").focus();
	//when form is submitted, capture the input value and then send it to server
	document
		.getElementsByTagName("form")[0]
		.addEventListener("submit", function (event) {
			event.preventDefault();
			socket.emit("chat message", {
				value: document.getElementById("m").value,
				user: userName
			});

			document.getElementById("m").value = "";
		});


	socket.on("chat message", (data) => {
		console.log(data.data.user + ": " + data.id);
		displayMessage(data);
	});


	function displayMessage(data) {
		let authorClass = "";
		let divClass = ""
		//verify that the user ID and the message sent ID is similar 
		if (data.id === ID) {
			console.log("This person has sent a message")
			authorClass = "me";
			divClass = "myDiv";
		} else {
			authorClass = "you";
			divClass = "yourDiv";
		}
		const div = document.createElement("div");
		div.className = divClass;
		const li = document.createElement("li");
		const p = document.createElement("p");
		p.className = "time";
		p.innerText = moment().format("hh:mm");
		div.innerHTML =
			'<span class="' +
			authorClass +
			'">' +
			data.data.user +
			" --></span>" +
			'<span class="message"> ' +
			data.data.value +
			"</span>";
		div.appendChild(p);
		li.appendChild(div);

		document.getElementById("messages").appendChild(li);
		//scroll to the bottom
		let messengerWindow = document.getElementById('messengerWindow');
		messengerWindow.scrollTo(0, messengerWindow.scrollHeight);
	}
</script>

</html>